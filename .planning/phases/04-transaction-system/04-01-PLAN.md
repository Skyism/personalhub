---
phase: 04-transaction-system
plan: 01
type: execute
---

<objective>
Display transactions within budget detail page with category breakdown and spending summary.

Purpose: Enable users to see their spending history and track progress against budget allocations.
Output: Budget detail page enhanced with transaction list and spending summary showing total and per-category actuals vs budget.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-supabase-backend/02-02-SUMMARY.md
@.planning/phases/03-budget-management/03-02-SUMMARY.md
@app/finance/budgets/[id]/page.tsx
@app/finance/budgets/[id]/CategoryAllocation.tsx
@lib/database.types.ts
@lib/supabase/server.ts

**Tech stack available:** @supabase/supabase-js@2.90.1, @supabase/ssr@0.8.0, Next.js App Router, TypeScript, Tailwind CSS

**Established patterns:**
- Server Components for data fetching (budgets list, detail pages)
- Client Components for interactivity ('use client' directive)
- Server Actions for mutations (budget creation, category operations)
- Hardcoded TEMP_USER_ID (00000000-0000-0000-0000-000000000000) for development
- Mobile-first Tailwind styling
- Color-coded categories using predefined Tailwind colors

**Constraining decisions:**
- Phase 02-02: Using numeric(10,2) for currency amounts, timestamptz for dates, nullable category_id in transactions, source column ('manual' vs 'sms')
- Phase 03-02: Category allocations with validation preventing over-budget allocation, RLS policies allow TEMP_USER_ID

**Issues being addressed:** None

**Concerns from Phase 3:**
- When implementing authentication, restore proper RLS policies (`auth.uid() = user_id` only) and re-add foreign key constraints to `auth.users(id)`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add transaction list section to budget detail page</name>
  <files>app/finance/budgets/[id]/page.tsx</files>
  <action>
Fetch transactions for the current budget using Server Component pattern. Query transactions table with:
- WHERE budget_id = current budget AND user_id = TEMP_USER_ID
- ORDER BY transaction_date DESC (newest first)
- Include category name and color via JOIN

Display transactions in a list with:
- Transaction date (formatted as MMM DD, YYYY)
- Amount (formatted with $ and 2 decimal places)
- Category badge (with color indicator if categorized, or "Uncategorized" in gray if null)
- Note text (if present)
- Source indicator ('manual' or 'sms' badge)

Use mobile-first responsive grid layout. Group transactions by date (Today, Yesterday, Earlier) for better UX. Handle empty state with helpful message: "No transactions yet. Add your first expense below."

DO NOT create a separate transactions page yet - embed this directly in the budget detail page below the CategoryAllocation component.
  </action>
  <verify>npm run build completes without TypeScript errors</verify>
  <done>Transaction list renders on budget detail page, shows all transaction fields, handles empty state gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Show spending summary</name>
  <files>app/finance/budgets/[id]/page.tsx</files>
  <action>
Add spending summary section ABOVE the transaction list. Calculate:
1. Total spent: SUM(transactions.amount) for current budget
2. Total budget: budget.total_budget
3. Remaining: total_budget - total_spent
4. Per-category spent: SUM(transactions.amount) GROUP BY category_id

Display summary with:
- Progress bar showing total_spent / total_budget percentage (visual indicator)
- "$X spent of $Y budget" with remaining amount
- Color-coded indicator: green if under 80%, yellow if 80-100%, red if over 100%
- Per-category breakdown showing: category name, spent vs allocated, percentage of allocation

Use the existing category_allocations data (already fetched in current page) and join with transaction sums. Handle categories with no transactions (show $0 spent).

DO NOT use chart libraries (Chart.js, Recharts) - that's Phase 6 (Analytics). Use simple Tailwind progress bars and text displays.
  </action>
  <verify>npm run build completes, spending calculations are accurate</verify>
  <done>Spending summary displays total and per-category actuals, progress bars render correctly, over-budget scenarios show red indicators</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Transaction display with spending summary on budget detail page</what-built>
  <how-to-verify>
1. Run: npm run dev
2. Visit: http://localhost:3000/finance/budgets
3. Click on any budget to view detail page
4. Verify empty state: "No transactions yet" message displays (no transactions exist yet)
5. Verify spending summary: Shows $0 spent of $X budget with empty progress bar
6. Verify category breakdown: Lists all allocated categories with $0 spent
7. Check responsive layout: Resize browser to mobile width, verify layout adapts
8. Confirm: No console errors, TypeScript builds cleanly
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] Budget detail page shows transaction list section (empty state initially)
- [ ] Spending summary displays with progress bars
- [ ] Per-category breakdown shows allocated vs spent
- [ ] Mobile responsive layout works correctly
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Transaction display infrastructure ready for Plan 04-02 to add entry form
- Spending calculations are accurate
- UI follows established mobile-first patterns
</success_criteria>

<output>
After completion, create `.planning/phases/04-transaction-system/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Transaction Display Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 04-02-PLAN.md (Manual Transaction Entry)
</output>
