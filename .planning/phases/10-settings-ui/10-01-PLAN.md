---
phase: 10-settings-ui
plan: 01
type: execute
---

<objective>
Create skincare settings page with morning reminder configuration form.

Purpose: Establish settings UI foundation and implement morning reminder configuration (toggle, time, message) using established Finance module CRUD patterns.
Output: Working settings page at /skincare/settings with Server Component data fetching and Client Component form for morning reminders.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-skincare-schema/09-01-SUMMARY.md

# Key files from prior work:
@supabase/migrations/20260114_create_skincare_schema.sql
@app/finance/categories/page.tsx
@app/finance/categories/CreateCategoryForm.tsx
@app/finance/budgets/new/page.tsx
@lib/supabase/client.ts
@lib/supabase/server.ts

**Tech stack available:**
- Next.js App Router with Server/Client Component split
- Supabase client utilities (browser + server)
- shadcn/ui Card, Button, Input components
- Tokyo Night color palette with semantic tokens
- Plus Jakarta Sans typography

**Established patterns:**
- Server Components for data fetching (categories/page.tsx pattern)
- Client Components for interactive forms (CreateCategoryForm.tsx pattern)
- Server Actions with validation (categories/actions.ts pattern)
- TEMP_USER_ID workaround (00000000-0000-0000-0000-000000000000)
- Toggle-based forms (collapsed by default, expand on click)
- inputMode attributes for mobile keyboards
- Loading states and disabled styling during submission

**Constraining decisions:**
- Phase 9: skincare_settings uses `time` type (not timestamptz) for daily recurring reminders
- Phase 9: Single settings row per user (UNIQUE constraint on user_id)
- Phase 9: Enable/disable toggles for morning and night independently
- Phase 2: Dual Supabase client pattern (browser for Client Components, server for Server Components)
- Phase 3: Server Actions with revalidatePath for cache invalidation

**Database schema** (from Phase 9):
- `skincare_settings` table: id, user_id, morning_enabled (boolean), morning_message (text), morning_time (time, default 08:00:00), night_enabled (boolean), night_time (time, default 22:30:00), created_at, updated_at
- RLS policies enabled for single-user access
- TypeScript types available in lib/database.types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skincare settings page with data fetching</name>
  <files>app/skincare/settings/page.tsx</files>
  <action>
Create Server Component at app/skincare/settings/page.tsx that:
1. Imports createClient from @/lib/supabase/server
2. Uses TEMP_USER_ID = '00000000-0000-0000-0000-000000000000' (consistent with Finance module)
3. Queries skincare_settings table filtering by user_id, selects all fields
4. If no settings exist, renders empty state prompting "Configure your skincare reminders below"
5. If settings exist, passes data to a <MorningReminderForm /> Client Component (create in Task 2)
6. Uses Tokyo Night Card component with bg-muted/50 backdrop-blur-sm border-border
7. Includes heading "Skincare Settings" with text-3xl font-bold
8. Uses max-w-2xl mx-auto mt-8 p-4 layout (consistent with finance pages)
9. Add error handling with console.error if query fails

Follow Finance module patterns: Server Component for data fetching, no 'use client', async function component.
  </action>
  <verify>TypeScript compiles without errors. File exists at app/skincare/settings/page.tsx. npm run build succeeds.</verify>
  <done>Settings page renders with Server Component data fetching, TEMP_USER_ID constant, empty state handling, and Card layout matching Finance aesthetic.</done>
</task>

<task type="auto">
  <name>Task 2: Build morning reminder configuration form</name>
  <files>app/skincare/settings/MorningReminderForm.tsx, app/skincare/settings/actions.ts</files>
  <action>
Create Client Component at app/skincare/settings/MorningReminderForm.tsx that:
1. Uses 'use client' directive
2. Accepts props: { initialSettings: Database['public']['Tables']['skincare_settings']['Row'] | null }
3. State: morningEnabled (boolean), morningTime (string in HH:MM format), morningMessage (string), isSubmitting (boolean), error (string | null)
4. Initialize state from initialSettings if provided, otherwise defaults: enabled=true, time='08:00', message=''
5. Uses shadcn/ui Card, CardHeader, CardTitle, CardContent components
6. Form fields:
   - Toggle/checkbox for morningEnabled with label "Enable Morning Reminder"
   - Input type="time" for morningTime with label "Morning Reminder Time", disabled if !morningEnabled
   - Textarea for morningMessage with label "Morning Message", placeholder "e.g., Time for your morning skincare routine!", disabled if !morningEnabled, maxLength 160 (SMS limit)
   - Character counter showing {morningMessage.length}/160
7. Submit button calls updateMorningSettings Server Action (create below)
8. Apply inputMode="text" to message textarea, autoComplete="off"
9. Disabled styling: opacity-60 cursor-not-allowed during isSubmitting
10. Success: clear error, show success message briefly
11. Error: display error message in destructive alert

Create Server Action at app/skincare/settings/actions.ts:
1. 'use server' directive
2. Export async function updateMorningSettings(enabled: boolean, time: string, message: string)
3. Import createClient from @/lib/supabase/server, revalidatePath from next/cache
4. Use TEMP_USER_ID constant
5. Validation: message length â‰¤ 160 chars, time matches HH:MM format (regex /^\d{2}:\d{2}$/)
6. Convert time from HH:MM to HH:MM:SS format for database (append ':00')
7. Query existing settings for user_id
8. If settings exist: UPDATE skincare_settings SET morning_enabled=enabled, morning_time=time, morning_message=message, updated_at=now() WHERE user_id=TEMP_USER_ID
9. If no settings: INSERT into skincare_settings (user_id, morning_enabled, morning_time, morning_message) VALUES (TEMP_USER_ID, enabled, time, message)
10. Call revalidatePath('/skincare/settings')
11. Return { success: true } or { success: false, error: string }

Use CreateCategoryForm.tsx and categories/actions.ts as reference patterns for Client Component form + Server Action.
  </action>
  <verify>MorningReminderForm.tsx and actions.ts exist. TypeScript compiles. curl or manual test shows form renders with toggle, time picker, textarea, and character counter. Submitting updates database and revalidates page.</verify>
  <done>Morning reminder form functional with toggle, time picker (type="time"), message textarea with 160-char limit and counter, Server Action with upsert logic, validation, and revalidatePath.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] TypeScript compilation passes
- [ ] Settings page accessible at /skincare/settings
- [ ] Form renders with all fields (toggle, time, message)
- [ ] Character counter updates as message is typed
- [ ] Submit updates database (verify with Supabase dashboard or query)
- [ ] Page revalidates after submit showing updated values
</verification>

<success_criteria>

- All tasks completed
- Settings page exists at app/skincare/settings/page.tsx using Server Component pattern
- MorningReminderForm Client Component with controlled inputs
- Server Action handles upsert (insert if no settings, update if exists)
- Validation prevents messages >160 chars
- Time picker uses HTML5 type="time" for native mobile keyboard
- Character counter shows N/160 format
- Loading states and disabled styling applied during submission
- No TypeScript errors or build failures
</success_criteria>

<output>
After completion, create `.planning/phases/10-settings-ui/10-01-SUMMARY.md`:

# Phase 10 Plan 1: Settings Page Foundation Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 10-02-PLAN.md (Night reminder configuration with message list management)
</output>
