---
phase: 06-analytics-dashboard
plan: 03
type: execute
---

<objective>
Create analytics dashboard page integrating all charts and optimize for mobile viewing.

Purpose: Provide a dedicated analytics view with comprehensive spending insights and mobile-friendly layout.
Output: /finance/analytics route with all three charts, responsive layout, and budget selector.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-analytics-dashboard/06-01-SUMMARY.md
@.planning/phases/06-analytics-dashboard/06-02-SUMMARY.md
@app/finance/budgets/[id]/page.tsx
@components/charts/CategorySpendingChart.tsx
@components/charts/SpendingTrendsChart.tsx
@components/charts/BudgetComparisonChart.tsx

**Tech stack available:** Next.js 16.1.1, TypeScript, Tailwind, Recharts 2.12.0, Supabase

**Established patterns:**
- Server Components for data fetching with Supabase
- Client Components for interactivity
- Budget selector dropdown pattern (from budget creation flow)
- Mobile-first responsive layouts with Tailwind

**Constraining decisions:**
- Phase 06-01: CategorySpendingChart ready with pie chart
- Phase 06-02: SpendingTrendsChart and BudgetComparisonChart ready
- Charts require Client Components, data prep in Server Component
- Mobile-first design is critical for on-the-go insights

**Current state:**
- Three chart components ready: CategorySpendingChart, SpendingTrendsChart, BudgetComparisonChart
- Budget detail page has data aggregation logic
- Need dedicated analytics page with budget selector
- Need responsive layout optimized for mobile viewing
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create analytics dashboard page with budget selector</name>
  <files>app/finance/analytics/page.tsx</files>
  <action>
Create Server Component at `app/finance/analytics/page.tsx`:
- Fetch user's budgets sorted by month DESC (most recent first)
- Get budget_id from searchParams (default to most recent if not provided)
- Fetch selected budget with transactions and category allocations (same queries as budget detail page)
- Calculate aggregated data for charts:
  1. **Category spending data:** Map categoryBreakdown to { name, value (spent), color }
  2. **Daily spending data:** Aggregate transactions by date: `{ date, amount, formattedDate }`
  3. **Budget comparison data:** Map categoryBreakdown to { category (name), budgeted (allocated), spent, color }

Layout structure:
```tsx
<div className="min-h-screen bg-gray-50 p-4">
  <div className="max-w-6xl mx-auto mt-8">
    {/* Header with budget selector */}
    <div className="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <h1 className="text-3xl font-bold text-gray-900">Analytics</h1>
      <BudgetSelector budgets={budgets} selectedBudgetId={budgetId} />
    </div>

    {/* Grid layout for charts */}
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      {/* Category Spending - Full width on mobile, left column on desktop */}
      <div className="bg-white rounded-lg shadow p-6">
        <h2 className="text-xl font-bold text-gray-900 mb-4">Category Spending</h2>
        <CategorySpendingChart data={categoryData} />
      </div>

      {/* Budget vs Actual - Full width on mobile, right column on desktop */}
      <div className="bg-white rounded-lg shadow p-6">
        <h2 className="text-xl font-bold text-gray-900 mb-4">Budget vs Actual</h2>
        <BudgetComparisonChart data={comparisonData} />
      </div>

      {/* Spending Trends - Full width on both mobile and desktop */}
      <div className="bg-white rounded-lg shadow p-6 lg:col-span-2">
        <h2 className="text-xl font-bold text-gray-900 mb-4">Spending Trends</h2>
        <SpendingTrendsChart data={dailyData} budgetTotal={budget.total_budget} />
      </div>
    </div>
  </div>
</div>
```

Data aggregation logic (adapt from budget detail page):
- Use same queries and calculations as `app/finance/budgets/[id]/page.tsx`
- Daily spending: Reduce transactions by date: `transactions.reduce((acc, t) => { ... }, {} as Record<string, number>)`
- Format dates for display: `new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })`

Handle empty states:
- If no budgets exist: Show message "Create your first budget to see analytics" with link to /finance/budgets/new
- If budget has no transactions: Charts will show their individual empty states
  </action>
  <verify>Page loads at /finance/analytics, displays budget selector, shows three charts with real data, responsive layout works on mobile and desktop</verify>
  <done>Analytics page created with budget selector, all three charts integrated, responsive grid layout, data aggregation from transactions and allocations</done>
</task>

<task type="auto">
  <name>Task 2: Create budget selector Client Component for analytics page</name>
  <files>app/finance/analytics/BudgetSelector.tsx</files>
  <action>
Create Client Component at `app/finance/analytics/BudgetSelector.tsx`:
- 'use client' directive
- Import useRouter, useSearchParams from next/navigation
- Import type Tables from @/lib/database.types

Props interface:
```typescript
type Budget = Tables<'budgets'>
type BudgetSelectorProps = {
  budgets: Budget[]
  selectedBudgetId: number
}
```

Implementation:
1. Use useRouter for navigation
2. Create select element with budgets mapped to options
3. Format month display: `new Date(budget.month + '-01').toLocaleDateString('en-US', { month: 'long', year: 'numeric' })`
4. On change: `router.push(/finance/analytics?budget_id=${selectedBudgetId})`
5. Styling: Tailwind classes for mobile-friendly dropdown

```tsx
<select
  value={selectedBudgetId}
  onChange={(e) => router.push(`/finance/analytics?budget_id=${e.target.value}`)}
  className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-gray-900"
>
  {budgets.map(budget => (
    <option key={budget.id} value={budget.id}>
      {formatMonth(budget.month)}
    </option>
  ))}
</select>
```

Mobile optimization:
- Use native select element (better mobile UX than custom dropdown)
- Adequate touch target size (py-2 = ~40px height)
- Clear focus styles for accessibility
  </action>
  <verify>Component renders select dropdown, changing selection navigates to new URL with budget_id query param, page reloads with new budget data</verify>
  <done>Budget selector component created with dropdown, budget navigation working, mobile-friendly native select element</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete analytics dashboard page with budget selector and all three interactive charts (category spending, spending trends, budget vs actual)</what-built>
  <how-to-verify>
1. Start dev server: npm run dev

2. Navigate to analytics dashboard:
   - Visit: http://localhost:3000/finance/analytics
   - Should load with most recent budget selected by default

3. Verify budget selector:
   - Dropdown shows list of budgets by month (e.g., "January 2026", "December 2025")
   - Current selection matches the budget being displayed
   - Change selection to different budget â†’ page reloads with new budget's data
   - URL updates with ?budget_id={id} query parameter
   - Charts update to reflect selected budget's data

4. Verify layout and responsiveness:
   - Desktop (>1024px):
     - Two-column grid: Category Spending (left), Budget vs Actual (right)
     - Spending Trends spans full width below
     - Adequate spacing between charts
   - Tablet (768-1024px):
     - Charts stack vertically
     - All charts full width
   - Mobile (<768px):
     - Single column layout
     - Charts full width
     - Budget selector full width
     - Scrollable if needed

5. Verify Category Spending chart:
   - Pie chart displays with category colors
   - Segments sized by spending amount
   - Hover shows category name and amount
   - Legend at bottom

6. Verify Spending Trends chart:
   - Line chart shows daily spending over time
   - X-axis has readable dates (angled on mobile)
   - Y-axis shows currency amounts
   - Blue line connects data points
   - Dashed reference line shows daily budget (total_budget / 30)
   - Hover tooltip shows date and amount

7. Verify Budget vs Actual chart:
   - Horizontal bars showing budgeted (gray) and spent (colored)
   - Color coding:
     - Green: Under 80% of budget
     - Yellow: 80-100% of budget
     - Red: Over budget
   - All category names visible
   - Hover shows budgeted, spent, and percentage

8. Test with different data scenarios:
   - Budget with many transactions: All charts populated
   - Budget with few transactions: Charts adjust size appropriately
   - Budget with no transactions: Charts show individual empty states
   - Budget with one category: Charts handle single data point

9. Test navigation:
   - From budget list (/finance/budgets): Add link to analytics
   - From analytics: Navigate back to budget list
   - Verify smooth navigation without errors

10. Test mobile usability:
    - Touch targets adequate size (budget selector, chart interactions)
    - Charts readable without zooming
    - Scrolling smooth on long pages
    - No horizontal overflow

11. Check build:
    - Run: npm run build
    - Verify: No errors or warnings
    - Charts render in production build
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Analytics page exists at /finance/analytics route
- [ ] BudgetSelector component exists and functional
- [ ] All three charts integrated on analytics page
- [ ] Budget selector changes update displayed data
- [ ] Responsive layout works on mobile, tablet, and desktop
- [ ] Empty states handled gracefully
- [ ] npm run build succeeds without errors
- [ ] Phase 6 complete - all analytics features functional
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Analytics dashboard page fully functional
- Budget selector working with query params
- All three charts integrated and responsive
- Mobile-optimized layout
- Empty states handled
- Phase 6 complete - ready for Phase 7 (Mobile Polish)
</success_criteria>

<output>
After completion, create `.planning/phases/06-analytics-dashboard/06-03-SUMMARY.md`:

# Phase 6 Plan 3: Analytics Dashboard Integration Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 6 complete. Ready for Phase 7 (Mobile Polish) - `/gsd:plan-phase 7`
</output>
