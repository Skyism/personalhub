---
phase: 06-analytics-dashboard
plan: 01
type: execute
---

<objective>
Set up Recharts library and create category spending breakdown visualization.

Purpose: Provide visual insight into where money is being spent across budget categories.
Output: Recharts installed, reusable chart wrapper component, category breakdown pie/donut chart.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-transaction-system/04-01-SUMMARY.md
@.planning/phases/03-budget-management/03-02-SUMMARY.md
@app/finance/budgets/[id]/page.tsx

**Tech stack available:** Next.js 16.1.1 App Router, TypeScript, Tailwind CSS, @supabase/supabase-js@2.90.1, React 19.2.3

**Established patterns:**
- Server Components for data fetching with Supabase joins
- Client Components for interactivity ('use client' directive)
- Mobile-first responsive design with Tailwind
- Spending calculations already implemented in budget detail page

**Constraining decisions:**
- Phase 04-01: Budget detail page already calculates categorySpending, totalSpent, spentPercentage per category
- Phase 03-02: Category allocations table exists with allocated_amount per category
- Mobile-first design is critical - charts must be responsive

**Current state:**
- Budget detail page shows spending summary with progress bars
- Category breakdown exists as text list with percentages
- Transaction data available with category_id joins
- Need visual representation for better insights

**Research completed:**
Recharts selected for charting library:
- React 19 compatible (version 2.12.0+)
- Responsive by default with ResponsiveContainer
- Native SSR support (use 'use client' wrapper)
- Tailwind CSS styling flexibility
- Tree-shakeable imports for minimal bundle

**Issues being addressed:** None
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and create responsive chart wrapper</name>
  <files>package.json, components/charts/ChartWrapper.tsx</files>
  <action>
Install Recharts library:
```bash
npm install recharts@2.12.0
```

Create reusable chart wrapper component at `components/charts/ChartWrapper.tsx`:
- Client Component ('use client' directive at top)
- Props: `{ children: ReactNode, height?: number, className?: string }`
- Use Recharts ResponsiveContainer with 100% width and configurable height (default 300px)
- Apply Tailwind classes for styling
- Export as default

Pattern:
```typescript
'use client'
import { ResponsiveContainer } from 'recharts'

export default function ChartWrapper({ children, height = 300, className = '' }) {
  return (
    <div className={`w-full ${className}`} style={{ height }}>
      <ResponsiveContainer width="100%" height="100%">
        {children}
      </ResponsiveContainer>
    </div>
  )
}
```

Why ResponsiveContainer: Automatically handles responsive sizing for mobile-first design without manual resize listeners.
  </action>
  <verify>npm list recharts shows recharts@2.12.0, ChartWrapper.tsx file exists with 'use client' and ResponsiveContainer import</verify>
  <done>Recharts installed in package.json, ChartWrapper component created with responsive container and configurable height</done>
</task>

<task type="auto">
  <name>Task 2: Create category spending breakdown pie chart component</name>
  <files>components/charts/CategorySpendingChart.tsx</files>
  <action>
Create Client Component at `components/charts/CategorySpendingChart.tsx`:
- 'use client' directive
- Import PieChart, Pie, Cell, Tooltip, Legend from recharts
- Import ChartWrapper from ./ChartWrapper

Props interface:
```typescript
type CategoryData = {
  name: string
  value: number // amount spent
  color: string | null
}
type CategorySpendingChartProps = {
  data: CategoryData[]
}
```

Implementation:
1. Filter out categories with value 0 (no spending)
2. If no data (all zero), show empty state: "No spending data yet"
3. Define color palette for categories without colors (fallback to Tailwind colors: blue-500, green-500, purple-500, orange-500, pink-500, etc.)
4. Use PieChart with:
   - Pie component with dataKey="value", nameKey="name"
   - Cell component for each entry with fill color from category.color or fallback palette
   - cx="50%", cy="50%" for centering
   - outerRadius responsive (80 for mobile, 100 for desktop) - use window.innerWidth check
   - label showing percentage: `{name}: {(percent * 100).toFixed(0)}%`
   - Tooltip showing name and formatted currency value
   - Legend positioned bottom, verticalAlign="bottom", formatted with icons

Format currency in tooltip:
```typescript
const formatCurrency = (value: number) =>
  new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value)
```

Wrap entire chart in ChartWrapper with height={400} for adequate space.

Mobile optimization: Use smaller outerRadius on mobile (< 768px) for better fit.
  </action>
  <verify>Component exports default, has 'use client', imports from recharts, handles empty state, shows formatted pie chart with colors</verify>
  <done>Category pie chart renders with colored segments, percentage labels, currency tooltip, responsive sizing, empty state for no data</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Category spending breakdown pie chart with Recharts, responsive wrapper, and mobile-optimized sizing</what-built>
  <how-to-verify>
1. Start dev server: npm run dev

2. Navigate to budget with transactions:
   - Visit: http://localhost:3000/finance/budgets
   - Click on a budget that has categorized transactions

3. Temporarily add the chart to budget detail page for testing:
   - Open: app/finance/budgets/[id]/page.tsx
   - Import at top: `import CategorySpendingChart from '@/components/charts/CategorySpendingChart'`
   - Add after spending summary section (around line 272):
   ```tsx
   <div className="bg-white rounded-lg shadow p-6 mt-6">
     <h2 className="text-2xl font-bold text-gray-900 mb-6">Category Spending</h2>
     <CategorySpendingChart
       data={categoryBreakdown.map(cat => ({
         name: cat.name,
         value: cat.spent,
         color: cat.color
       }))}
     />
   </div>
   ```
   - Save and refresh

4. Verify pie chart:
   - Chart displays with colored segments for each category
   - Segments sized proportionally to spending
   - Labels show category names and percentages
   - Hover tooltip shows category name and currency amount (e.g., "Food: $125.50")
   - Legend at bottom lists all categories with color indicators
   - Chart is centered and sized appropriately

5. Test responsive behavior:
   - Desktop (>768px): Verify chart uses larger radius, readable labels
   - Mobile (< 768px): Verify chart uses smaller radius, still readable
   - Resize browser window: Verify chart adjusts smoothly

6. Test empty state:
   - Navigate to budget with no transactions or all uncategorized
   - Verify: Shows "No spending data yet" message instead of broken chart

7. Test colors:
   - Categories with colors: Verify custom category colors display
   - Categories without colors: Verify fallback palette colors (blue, green, purple, etc.)

8. After verification, REMOVE the temporary chart addition from page.tsx (we'll add it properly in Plan 3)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm list recharts shows recharts@2.12.0 installed
- [ ] ChartWrapper component exists with ResponsiveContainer
- [ ] CategorySpendingChart component exists with PieChart
- [ ] Chart renders with actual spending data
- [ ] Responsive sizing works on mobile and desktop
- [ ] Empty state handles budgets with no spending
- [ ] npm run build succeeds without errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Recharts library installed and functional
- Reusable ChartWrapper component created
- Category spending pie chart renders correctly
- Mobile-responsive with appropriate sizing
- Empty state handling
- Ready for Plan 2 (trends and budget vs actual charts)
</success_criteria>

<output>
After completion, create `.planning/phases/06-analytics-dashboard/06-01-SUMMARY.md`:

# Phase 6 Plan 1: Chart Foundation and Category Breakdown Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 06-02-PLAN.md (Spending trends and budget vs actual charts)
</output>
