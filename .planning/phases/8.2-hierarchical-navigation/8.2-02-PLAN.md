---
phase: 8.2-hierarchical-navigation
plan: 02
type: execute
---

<objective>
Create breadcrumb and top app bar navigation system for hierarchical context.

Purpose: Provide users with hierarchical navigation context (breadcrumbs) and easy back navigation (top app bar with back button) on all Finance module pages. Solves critical UX gap where users are trapped in module with no way to navigate up the hierarchy.
Output: Working Breadcrumbs and TopAppBar components integrated into all Finance pages with proper accessibility and responsive behavior.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/8.2-hierarchical-navigation/8.2-RESEARCH.md
@.planning/phases/8.2-hierarchical-navigation/8.2-01-PLAN.md
@app/finance/page.tsx
@app/finance/budgets/page.tsx
@app/finance/wants/page.tsx
@app/finance/analytics/page.tsx
@app/finance/categories/page.tsx

**From Research:**
- Use Next.js `usePathname()` for dynamic breadcrumbs with label mapping
- Use `useRouter().back()` with fallback href for back button
- W3C ARIA Breadcrumb Pattern: `<nav aria-label="Breadcrumbs">`, `<ol>` structure, `aria-current="page"` on last item
- Mobile truncation: show last 2 items on mobile, full trail on desktop
- ChevronRight separators with `aria-hidden="true"`

**Don't hand-roll (from research):**
- Pathname parsing for breadcrumbs → use `usePathname()` + segment mapping
- Back button navigation → use `useRouter().back()` + fallback Link
- Breadcrumb accessibility → follow W3C ARIA pattern exactly

**Existing Finance pages to integrate:**
- /finance (landing)
- /finance/budgets (list)
- /finance/budgets/[id] (detail)
- /finance/budgets/new (create)
- /finance/wants (overview)
- /finance/analytics (charts)
- /finance/categories (list)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dynamic Breadcrumbs component with ARIA accessibility</name>
  <files>components/navigation/Breadcrumbs.tsx</files>
  <action>
Create Client Component with Next.js usePathname() for dynamic breadcrumb generation:

**Label mapping (breadcrumbLabels object):**
```typescript
const breadcrumbLabels: Record<string, string> = {
  '/': 'Home',
  '/finance': 'Finance',
  '/finance/budgets': 'Budgets',
  '/finance/wants': 'Wants Budget',
  '/finance/analytics': 'Analytics',
  '/finance/categories': 'Categories',
}
```

**Implementation requirements:**
- 'use client' directive (requires usePathname)
- Import: usePathname from 'next/navigation', Link from 'next/link', ChevronRight from 'lucide-react'
- Return null if pathname === '/' (no breadcrumbs on home)
- Parse pathname: `pathname.split('/').filter(Boolean)` for segments
- Build breadcrumb trail by mapping segments to paths and labels
- Use fallback label for dynamic segments: `breadcrumbLabels[path] || segment.charAt(0).toUpperCase() + segment.slice(1)`

**ARIA structure (W3C pattern):**
- `<nav aria-label="Breadcrumbs">` container
- `<ol className="flex items-center space-x-2">` for list
- Home link first (always visible)
- ChevronRight separator with `aria-hidden="true"` between items
- Last item: `<span aria-current="page">` (not Link)
- Other items: `<Link>` with hover effects

**Responsive behavior:**
- Desktop: show full breadcrumb trail
- Mobile: show last 2 items only (lg:hidden class on truncation logic)
- Use text-sm for mobile readability

**Styling (Tokyo Night):**
- Links: `text-muted-foreground hover:text-foreground transition-colors`
- Current page: `font-medium text-foreground`
- Separator: `h-4 w-4 text-muted-foreground`
- Container: `flex items-center space-x-2`

DON'T use window.location - use Next.js usePathname() hook
DON'T hardcode breadcrumb labels for every possible route - use label map with fallback
DON'T skip ARIA attributes - screen readers need aria-label and aria-current
  </action>
  <verify>
1. Component compiles without TypeScript errors
2. Import in a test page, navigate to /finance/budgets, confirm breadcrumbs show "Home / Finance / Budgets"
3. Last item ("Budgets") is not a link and has aria-current="page"
4. Inspect element confirms `<nav aria-label="Breadcrumbs">` and `<ol>` structure
5. Hover over breadcrumb links shows color transition
  </verify>
  <done>Breadcrumbs component created with usePathname(), label mapping, W3C ARIA pattern, responsive truncation, Tokyo Night styling</done>
</task>

<task type="auto">
  <name>Task 2: Create TopAppBar component with back button and breadcrumbs</name>
  <files>components/navigation/TopAppBar.tsx</files>
  <action>
Create Client Component combining back button and breadcrumbs:

**Props interface:**
```typescript
interface TopAppBarProps {
  showBackButton?: boolean  // default true
  fallbackHref?: string     // hierarchical parent for direct links
  title?: string            // optional page title
}
```

**Back button implementation:**
- 'use client' directive
- Import: useRouter from 'next/navigation', ArrowLeft from 'lucide-react', Breadcrumbs component
- handleBack function: check `window.history.length > 1` → router.back(), else fallbackHref → router.push()
- Button with aria-label="Go back", ArrowLeft icon, "Back" text (hidden on mobile: `hidden sm:inline`)
- Styling: `text-muted-foreground hover:text-foreground transition-colors`

**Layout structure:**
```
<div className="border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
  <div className="container mx-auto px-4 py-3">
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-4">
        {showBackButton && <BackButton />}
        {title && <h1 className="text-xl font-semibold">{title}</h1>}
      </div>
      <Breadcrumbs />
    </div>
  </div>
</div>
```

**Styling details:**
- Frosted glass effect: `bg-background/95 backdrop-blur` (matches BottomNav pattern from Phase 7)
- Border: `border-b` for separation
- Responsive: container with px-4, flex layout with justify-between
- Back button + title on left, breadcrumbs on right

DON'T use only window.history.back() - provide fallbackHref for direct link navigation
DON'T make entire component Server Component - useRouter requires 'use client'
DON'T forget typeof window !== 'undefined' check for SSR safety when accessing window
  </action>
  <verify>
1. Component compiles without TypeScript errors
2. Import in test page with fallbackHref="/finance", click back button, confirm it navigates back
3. TopAppBar renders with breadcrumbs on right side, back button on left
4. Backdrop blur effect visible on container
5. "Back" text visible on desktop (sm+), hidden on mobile
  </verify>
  <done>TopAppBar component created with back button (router.back() + fallback), breadcrumbs integration, frosted glass styling, responsive layout</done>
</task>

<task type="auto">
  <name>Task 3: Integrate TopAppBar into all Finance module pages</name>
  <files>app/finance/page.tsx, app/finance/budgets/page.tsx, app/finance/wants/page.tsx, app/finance/analytics/page.tsx, app/finance/categories/page.tsx</files>
  <action>
Add TopAppBar to each Finance page with appropriate fallback hrefs:

**Import statement for each file:**
```typescript
import TopAppBar from '@/components/navigation/TopAppBar'
```

**Integration pattern (add before existing page content):**
- /finance/page.tsx: `<TopAppBar fallbackHref="/" />`
- /finance/budgets/page.tsx: `<TopAppBar fallbackHref="/finance" />`
- /finance/wants/page.tsx: `<TopAppBar fallbackHref="/finance" />`
- /finance/analytics/page.tsx: `<TopAppBar fallbackHref="/finance" />`
- /finance/categories/page.tsx: `<TopAppBar fallbackHref="/finance" />`

**Structure (wrap or prepend to existing content):**
```tsx
export default function Page() {
  return (
    <>
      <TopAppBar fallbackHref="/finance" />
      <div className="container mx-auto p-4">
        {/* existing page content */}
      </div>
    </>
  )
}
```

**Fallback href logic:**
- Finance landing (/finance) → fallback to / (app home)
- All Finance subpages → fallback to /finance (Finance landing)
- DON'T point all pages back to same place - respect hierarchy

**Note on budgets/[id] and budgets/new:**
These are dynamic routes not listed in files array since they're less critical for v1. Skip them in this task. Can be added later if needed.

DON'T change page structure significantly - add TopAppBar at top, keep rest intact
DON'T remove existing headers or navigation - TopAppBar is additive
DON'T use Server Component for TopAppBar - it's already a Client Component
  </action>
  <verify>
1. `npm run build` succeeds without errors
2. Visit /finance/budgets, confirm TopAppBar shows at top with back button and breadcrumbs
3. Click back button from /finance/budgets, confirm navigation to /finance
4. Visit each Finance page (/finance, /budgets, /wants, /analytics, /categories), confirm TopAppBar present
5. Breadcrumbs show correct trail for each page
6. No TypeScript errors or console warnings
  </verify>
  <done>TopAppBar integrated into all main Finance pages with appropriate fallback hrefs, breadcrumbs visible, back button functional</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Breadcrumbs component follows W3C ARIA pattern (aria-label, aria-current)
- [ ] TopAppBar shows on all Finance pages with back button and breadcrumbs
- [ ] Back button works from Finance pages (navigates up hierarchy)
- [ ] Breadcrumbs show correct trail (Home / Finance / Page Name)
- [ ] Mobile truncation works (last 2 items on small screens)
- [ ] No TypeScript errors or console warnings
</verification>

<success_criteria>

- Breadcrumbs component created with usePathname(), ARIA accessibility, responsive truncation
- TopAppBar component created with back button (router.back + fallback) and breadcrumbs
- TopAppBar integrated into 5 main Finance pages with correct fallback hrefs
- All verification checks pass
- Navigation hierarchy now visible and functional
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/8.2-hierarchical-navigation/8.2-02-SUMMARY.md`:

# Phase 8.2 Plan 2: Breadcrumb & Top App Bar System Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- Created dynamic Breadcrumbs component with W3C ARIA accessibility
- Created TopAppBar component with back button and breadcrumbs integration
- Integrated TopAppBar into all main Finance pages
- Implemented responsive breadcrumb truncation (full trail desktop, last 2 items mobile)
- Applied Tokyo Night design with frosted glass backdrop effect

## Files Created/Modified

- `components/navigation/Breadcrumbs.tsx` - Dynamic breadcrumbs with usePathname()
- `components/navigation/TopAppBar.tsx` - Back button + breadcrumbs container
- `app/finance/page.tsx` - Added TopAppBar with fallback to /
- `app/finance/budgets/page.tsx` - Added TopAppBar with fallback to /finance
- `app/finance/wants/page.tsx` - Added TopAppBar with fallback to /finance
- `app/finance/analytics/page.tsx` - Added TopAppBar with fallback to /finance
- `app/finance/categories/page.tsx` - Added TopAppBar with fallback to /finance

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 8.2-03-PLAN.md (desktop navigation sidebar for lg+ screens)
</output>
