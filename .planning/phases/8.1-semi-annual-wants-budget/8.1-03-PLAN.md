---
phase: 8.1-semi-annual-wants-budget
plan: 03
type: execute
---

<objective>
Build wants budget setup and overview UI with current period display, spending progress, and configuration management.

Purpose: Provide user interface for creating/editing semi-annual wants budgets and viewing current period spending status.
Output: Wants budget overview page at `/finance/wants` with setup functionality and progress visualization.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/8.1-semi-annual-wants-budget/8.1-01-SUMMARY.md
@.planning/phases/8.1-semi-annual-wants-budget/8.1-02-SUMMARY.md
@.planning/phases/03-budget-management/03-01-SUMMARY.md
@.planning/phases/08-ui-overhaul/08-01-SUMMARY.md
@app/finance/page.tsx
@app/finance/layout.tsx
@lib/wants/periods.ts
@lib/wants/queries.ts

**Tech stack available:**
- Next.js 16+ with App Router (Phase 1)
- React Server Components and Server Actions (Phase 3)
- shadcn/ui Card, Button components (Phase 8)
- Tokyo Night design system with OKLCH palette (Phase 8)
- Plus Jakarta Sans typography (Phase 8)
- Framer Motion for animations (Phase 8)
- Wants database schema and period utilities (Phase 8.1 Plans 1-2)

**Established patterns:**
- Finance module structure: /finance/[feature]/page.tsx (Phase 3-6)
- Server Components for data fetching, Client Components for interactivity (Phase 3)
- Server Actions for mutations with revalidatePath (Phase 3)
- shadcn/ui Card with Tokyo Night styling (Phase 8)
- Mobile-first responsive design with Tailwind (Phase 7)
- Motion animations with stagger reveals (Phase 8)
- Numeric input with inputMode="decimal" (Phase 7)

**Constraining decisions:**
- Phase 8: Tokyo Night color palette (--background, --foreground, --primary, --accent)
- Phase 8: Plus Jakarta Sans for UI text, JetBrains Mono for numbers
- Phase 7: 44px minimum touch targets for mobile
- Phase 3: Optimistic UI updates with revalidatePath
- Phase 8.1: Semi-annual periods only (H1: Jan-Jun, H2: Jul-Dec)

**Issues being addressed:** None
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create wants budget setup page with period configuration</name>
  <files>app/finance/wants/page.tsx, app/finance/wants/actions.ts</files>
  <action>
Create `/app/finance/wants/page.tsx` as Server Component that:

1. Fetches current period wants budget (if exists)
2. Fetches total spent in current period (sum of wants_transactions.amount)
3. Displays setup form if no budget, overview if budget exists

**Server Component structure:**
```typescript
import { createClient } from '@/lib/supabase/server';
import { getCurrentWantsPeriod, formatPeriodLabel } from '@/lib/wants/periods';
import { WantsBudgetForm } from './components/budget-form';
import { WantsOverview } from './components/overview';

const TEMP_USER_ID = '00000000-0000-0000-0000-000000000000';

export default async function WantsPage() {
  const supabase = await createClient();
  const period = getCurrentWantsPeriod();

  // Fetch current period budget
  const { data: budget } = await supabase
    .from('wants_budgets')
    .select('id, total_amount, period_start, period_end')
    .eq('user_id', TEMP_USER_ID)
    .eq('period_start', period.periodStart)
    .maybeSingle();

  // Fetch total spent this period
  let totalSpent = 0;
  if (budget) {
    const { data: transactions } = await supabase
      .from('wants_transactions')
      .select('amount')
      .eq('wants_budget_id', budget.id);

    totalSpent = transactions?.reduce((sum, t) => sum + Number(t.amount), 0) ?? 0;
  }

  return (
    <div className="container mx-auto p-4 space-y-6">
      <div>
        <h1 className="text-3xl font-bold">Wants Budget</h1>
        <p className="text-muted-foreground mt-1">{period.label} (6-month period)</p>
      </div>

      {!budget ? (
        <WantsBudgetForm period={period} />
      ) : (
        <WantsOverview budget={budget} totalSpent={totalSpent} period={period} />
      )}
    </div>
  );
}
```

**Server Actions in `/app/finance/wants/actions.ts`:**
```typescript
'use server';

import { createClient } from '@/lib/supabase/server';
import { revalidatePath } from 'next/cache';

const TEMP_USER_ID = '00000000-0000-0000-0000-000000000000';

export async function createWantsBudget(periodStart: string, periodEnd: string, totalAmount: number) {
  const supabase = await createClient();

  const { error } = await supabase.from('wants_budgets').insert({
    user_id: TEMP_USER_ID,
    period_start: periodStart,
    period_end: periodEnd,
    total_amount: totalAmount,
  });

  if (error) throw new Error(error.message);

  revalidatePath('/finance/wants');
  return { success: true };
}

export async function updateWantsBudget(budgetId: number, totalAmount: number) {
  const supabase = await createClient();

  const { error } = await supabase
    .from('wants_budgets')
    .update({ total_amount: totalAmount, updated_at: new Date().toISOString() })
    .eq('id', budgetId);

  if (error) throw new Error(error.message);

  revalidatePath('/finance/wants');
  return { success: true };
}
```

Use Tokyo Night design system colors. Follow established Finance page patterns. Include helpful messaging about semi-annual periods.

Avoid creating navigation components yet (Task 3). Avoid transaction list UI (that's Plan 4). Avoid complex animations (keep it clean and fast).
  </action>
  <verify>npm run dev, visit /finance/wants shows setup form, can create budget, page reloads with overview</verify>
  <done>Page displays current period, setup form creates budget via Server Action, revalidation works, follows Tokyo Night styling</done>
</task>

<task type="auto">
  <name>Task 2: Create budget form and overview components</name>
  <files>app/finance/wants/components/budget-form.tsx, app/finance/wants/components/overview.tsx</files>
  <action>
Create Client Components for budget management:

**BudgetForm component (`budget-form.tsx`):**
- shadcn/ui Card with form for total_amount input
- Label: "Total Budget for {period.label}"
- Input: numeric with inputMode="decimal", step="0.01", min="0.01"
- Submit button: "Set Budget" or "Update Budget"
- Uses createWantsBudget or updateWantsBudget Server Action
- Shows loading state during submission
- Error handling with toast or inline message

**Overview component (`overview.tsx`):**
- shadcn/ui Card showing:
  - Budget amount (large, JetBrains Mono)
  - Total spent (with color: green if under budget, red if over)
  - Remaining amount
  - Progress bar (shadcn/ui Progress or custom div with bg-primary)
  - Edit button to toggle inline edit mode
- Format currency: `$${amount.toFixed(2)}`
- Progress calculation: (totalSpent / totalAmount) * 100
- Color coding: <80% green, 80-100% yellow, >100% red

Follow Mobile Polish patterns (Phase 7): 44px touch targets, responsive text sizing.
Follow UI Overhaul patterns (Phase 8): Tokyo Night colors, Plus Jakarta Sans, subtle motion on load.

Avoid complex state management (keep it simple with useState). Avoid external chart libraries (simple progress bar sufficient). Avoid premature optimization (straightforward rendering first).
  </action>
  <verify>Components render correctly, form submission works, overview shows accurate calculations, responsive on mobile</verify>
  <done>Form creates/updates budget, overview displays spending status with progress bar, styling follows Tokyo Night design system, mobile-friendly</done>
</task>

<task type="auto">
  <name>Task 3: Add wants budget navigation to Finance module</name>
  <files>app/finance/layout.tsx, app/finance/page.tsx</files>
  <action>
Add "Wants Budget" navigation link to Finance module:

**In `/app/finance/layout.tsx`:**
- Add navigation link for `/finance/wants`
- Label: "Wants Budget" or "Wants" (keep concise)
- Place after existing nav items (Budgets, Categories, Analytics)
- Use existing navigation component pattern from layout
- Highlight active link when on /finance/wants route

**Update `/app/finance/page.tsx` (landing page):**
- Add Card for "Wants Budget" feature
- Brief description: "Track semi-annual wants spending (Jan-Jun, Jul-Dec)"
- Link to /finance/wants
- Follow existing card pattern for Budgets/Categories/Analytics cards

Use consistent styling with existing Finance nav. Maintain responsive mobile navigation (Phase 7).

Avoid creating new navigation components (extend existing pattern). Avoid changing existing nav structure (append, don't refactor). Avoid complex routing logic (simple Link components).
  </action>
  <verify>Navigation shows Wants Budget link, clicking navigates to /finance/wants, landing page includes wants card</verify>
  <done>Wants budget accessible from Finance nav and landing page, navigation highlighting works, styling consistent with module</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without TypeScript errors
- [ ] /finance/wants page loads without errors
- [ ] Budget setup form creates budget successfully
- [ ] Overview shows accurate spending calculations and progress
- [ ] Navigation link visible and functional from Finance module
- [ ] Mobile responsive (test at 375px width)
- [ ] Tokyo Night design system colors applied correctly
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Wants budget page fully functional for setup and overview
- Server Actions handle create/update operations
- Progress visualization works correctly
- Navigation integrated into Finance module
- Mobile-first responsive design
- Follows established Tokyo Night styling patterns
</success_criteria>

<output>
After completion, create `.planning/phases/8.1-semi-annual-wants-budget/8.1-03-SUMMARY.md`:

# Phase 8.1 Plan 3: Wants Budget UI Foundation Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- Wants budget overview page at /finance/wants
- Budget setup form with Server Action for create/update
- Spending overview with progress bar and color-coded status
- Navigation integration in Finance module
- Tokyo Night design system styling throughout
- Mobile-responsive with 44px touch targets

## Files Created/Modified

- `app/finance/wants/page.tsx` - Server Component for wants overview
- `app/finance/wants/actions.ts` - Server Actions for budget CRUD
- `app/finance/wants/components/budget-form.tsx` - Budget configuration form
- `app/finance/wants/components/overview.tsx` - Spending status display
- `app/finance/layout.tsx` - Added wants budget navigation
- `app/finance/page.tsx` - Added wants budget card

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 8.1-04-PLAN.md (wants transactions CRUD for manual entry and management)
</output>
