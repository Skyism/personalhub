---
phase: 8.1-semi-annual-wants-budget
plan: 04
type: execute
---

<objective>
Implement CRUD operations for wants transactions with list view, manual entry form, and edit/delete capabilities.

Purpose: Enable users to manually add, view, edit, and delete wants transactions for the current semi-annual period.
Output: Complete transaction management interface integrated with wants budget overview page.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/8.1-semi-annual-wants-budget/8.1-01-SUMMARY.md
@.planning/phases/8.1-semi-annual-wants-budget/8.1-02-SUMMARY.md
@.planning/phases/8.1-semi-annual-wants-budget/8.1-03-SUMMARY.md
@.planning/phases/04-transaction-system/04-01-SUMMARY.md
@.planning/phases/04-transaction-system/04-02-SUMMARY.md
@app/finance/wants/page.tsx
@app/finance/wants/actions.ts

**Tech stack available:**
- Next.js Server Components and Server Actions (Phase 3)
- shadcn/ui Card, Button, Dialog components (Phase 8)
- Tokyo Night design system (Phase 8)
- Framer Motion for animations (Phase 8)
- Wants budget schema with transaction management (Phase 8.1 Plans 1-3)

**Established patterns:**
- Transaction list with date grouping (Phase 4)
- Server Actions for CRUD with revalidatePath (Phase 4)
- shadcn/ui Dialog for forms (Phase 3)
- Manual transaction entry with amount + note fields (Phase 4)
- Mobile-first forms with inputMode and autoComplete (Phase 7)
- Motion stagger animations for lists (Phase 8)

**Constraining decisions:**
- Phase 4: Display transactions grouped by date, newest first
- Phase 4: Server Actions for all mutations (no client-side state management)
- Phase 7: 44px touch targets, numeric keyboard for amount input
- Phase 8: Subtle motion animations on list reveals
- Phase 8.1: Transactions scoped to current wants_budget only

**Issues being addressed:** None
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wants transaction list to overview page</name>
  <files>app/finance/wants/page.tsx, app/finance/wants/components/transaction-list.tsx</files>
  <action>
Update `/app/finance/wants/page.tsx` to fetch and display wants transactions:

**Extend Server Component query:**
```typescript
// After fetching budget and totalSpent...
let transactions = [];
if (budget) {
  const { data } = await supabase
    .from('wants_transactions')
    .select('id, amount, note, transaction_date, source, created_at')
    .eq('wants_budget_id', budget.id)
    .order('transaction_date', { ascending: false })
    .order('created_at', { ascending: false });

  transactions = data ?? [];
}

// Pass to overview:
<WantsOverview budget={budget} totalSpent={totalSpent} period={period} transactions={transactions} />
```

**Create `transaction-list.tsx` Client Component:**
- Receives transactions array as prop
- Groups transactions by date (same logic as Phase 4 transaction list)
- Displays each transaction: amount (JetBrains Mono), note, source badge ('SMS' or 'Manual')
- Each transaction has Edit and Delete buttons (icon buttons, 44px touch targets)
- Empty state: "No transactions yet. Add one below or text 'wants amount note'."
- Motion stagger reveal animation on mount (framer-motion)

Follow Phase 4 transaction list patterns. Use Tokyo Night colors for badges (SMS: accent, Manual: muted).

Avoid pagination (simple list for MVP). Avoid complex filtering (show all current period transactions). Avoid real-time updates (revalidatePath on mutations is sufficient).
  </action>
  <verify>Transaction list displays existing transactions, groups by date, shows source badges, empty state appears when no transactions</verify>
  <done>Transaction list renders with date grouping, source indicators, edit/delete buttons, motion animations, empty state guidance</done>
</task>

<task type="auto">
  <name>Task 2: Implement add and edit transaction forms</name>
  <files>app/finance/wants/components/transaction-form.tsx, app/finance/wants/actions.ts</files>
  <action>
Create transaction form component and Server Actions for add/edit:

**TransactionForm component (`transaction-form.tsx`):**
- shadcn/ui Dialog with form for amount, note, transaction_date
- Fields:
  - Amount: numeric input, inputMode="decimal", step="0.01", min="0.01", required
  - Note: text input, optional, placeholder="What did you spend on?"
  - Date: date input, defaults to today, max=today (can't add future transactions)
- Two modes: "add" (create new) and "edit" (update existing)
- Submit button: "Add Transaction" or "Save Changes"
- Cancel button closes dialog
- Loading state during submission
- Form validation: amount > 0, date not in future

**Add to `actions.ts`:**
```typescript
export async function createWantsTransaction(budgetId: number, amount: number, note: string | null, transactionDate: string) {
  const supabase = await createClient();

  const { error } = await supabase.from('wants_transactions').insert({
    user_id: TEMP_USER_ID,
    wants_budget_id: budgetId,
    amount,
    note,
    transaction_date: transactionDate,
    source: 'manual',
  });

  if (error) throw new Error(error.message);

  revalidatePath('/finance/wants');
  return { success: true };
}

export async function updateWantsTransaction(transactionId: number, amount: number, note: string | null, transactionDate: string) {
  const supabase = await createClient();

  const { error } = await supabase
    .from('wants_transactions')
    .update({ amount, note, transaction_date: transactionDate, updated_at: new Date().toISOString() })
    .eq('id', transactionId);

  if (error) throw new Error(error.message);

  revalidatePath('/finance/wants');
  return { success: true };
}
```

Integrate form in overview component with "Add Transaction" button (prominent, above transaction list).
For edit: populate form with existing transaction data when Edit button clicked.

Follow Phase 7 mobile patterns (autocomplete="off" for custom fields, smooth focus management).

Avoid complex date pickers (native date input is sufficient). Avoid category selection (wants transactions don't need categories). Avoid file uploads or attachments (keep it simple).
  </action>
  <verify>Form opens on Add/Edit click, submits successfully, page reloads with updated transaction list, validation works</verify>
  <done>Add and edit forms functional, Server Actions create/update transactions, revalidation refreshes list, mobile-friendly inputs</done>
</task>

<task type="auto">
  <name>Task 3: Implement delete transaction with confirmation</name>
  <files>app/finance/wants/components/delete-dialog.tsx, app/finance/wants/actions.ts</files>
  <action>
Create delete confirmation dialog and Server Action:

**DeleteDialog component (`delete-dialog.tsx`):**
- shadcn/ui AlertDialog for delete confirmation
- Shows transaction amount and note in confirmation message
- "Delete" button (destructive variant, red)
- "Cancel" button (secondary)
- Triggered from transaction list Delete button

**Add to `actions.ts`:**
```typescript
export async function deleteWantsTransaction(transactionId: number) {
  const supabase = await createClient();

  const { error } = await supabase
    .from('wants_transactions')
    .delete()
    .eq('id', transactionId);

  if (error) throw new Error(error.message);

  revalidatePath('/finance/wants');
  return { success: true };
}
```

Confirmation message: "Delete $25.00 transaction for 'coffee'? This cannot be undone."

Follow destructive action patterns: red button, confirmation required, clear messaging.

Avoid soft deletes (hard delete is fine for MVP). Avoid undo functionality (keep it simple). Avoid bulk delete (single transaction delete only).
  </action>
  <verify>Delete button opens confirmation, confirming deletes transaction and refreshes list, canceling closes dialog without action</verify>
  <done>Delete confirmation works, Server Action removes transaction, list updates via revalidation, destructive styling applied</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without TypeScript errors
- [ ] Transaction list displays with date grouping
- [ ] Add transaction form creates new transaction successfully
- [ ] Edit transaction form updates existing transaction
- [ ] Delete confirmation works and removes transaction
- [ ] Overview totals update after CRUD operations
- [ ] Forms validate input (amount > 0, no future dates)
- [ ] Mobile responsive (375px width)
- [ ] SMS-created transactions display correctly with 'SMS' badge
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Full CRUD operations for wants transactions functional
- Transaction list integrated with overview page
- Server Actions handle all mutations with revalidation
- Confirmation required for destructive delete action
- Mobile-first responsive design maintained
- Tokyo Night design system applied consistently
- Phase 8.1 complete - wants budget feature fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/8.1-semi-annual-wants-budget/8.1-04-SUMMARY.md`:

# Phase 8.1 Plan 4: Wants Transactions CRUD Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- Transaction list with date grouping and source badges
- Add transaction form with date and amount inputs
- Edit transaction functionality with pre-populated form
- Delete transaction with confirmation dialog
- Server Actions for all CRUD operations
- Real-time overview updates via revalidatePath
- Mobile-friendly forms and touch targets

## Files Created/Modified

- `app/finance/wants/page.tsx` - Added transaction fetching and display
- `app/finance/wants/components/transaction-list.tsx` - Transaction list with grouping
- `app/finance/wants/components/transaction-form.tsx` - Add/edit form component
- `app/finance/wants/components/delete-dialog.tsx` - Delete confirmation
- `app/finance/wants/actions.ts` - CRUD Server Actions for transactions

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 8.1 complete. Semi-annual wants budget feature fully functional with:
- Database schema for 6-month budget periods
- SMS integration via "wants" keyword
- Budget setup and overview UI
- Full CRUD operations for manual transaction entry
- Progress tracking and spending visualization
- Integration with existing Finance module

Ready to return to v1.1 Skincare Reminders milestone (Phase 12) or continue with additional Finance enhancements.
</output>
