---
phase: 02-supabase-backend
plan: 01
type: execute
---

<objective>
Set up Supabase client utilities for Next.js App Router and verify connection.

Purpose: Establish foundational Supabase integration patterns that all future database operations will use.
Output: Working Supabase client utilities (browser + server) with verified connection to project.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-supabase-backend/DISCOVERY.md
@.planning/phases/1-foundation/1-01-SUMMARY.md

**Tech stack available:** next-js@16.1.1, typescript@5, tailwind-css@4, app-router
**Established patterns:** Feature-based modules (app/finance, app/skincare, app/fitness), top-level app folders

**From Discovery:**
- Requires dual client setup: browser client + server client
- Browser client for Client Components, server client for Server Components/Actions
- Must use `@supabase/ssr` package for App Router support
- Environment variables needed: NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Supabase packages and configure environment</name>
  <files>package.json, .env.local</files>
  <action>
    Install `@supabase/supabase-js` and `@supabase/ssr` packages via npm.
    Create `.env.local` file (copy from .env.local.example) with placeholder values for:
    - NEXT_PUBLIC_SUPABASE_URL
    - NEXT_PUBLIC_SUPABASE_ANON_KEY
    Do NOT commit .env.local (already in .gitignore). Update .env.local.example to use NEXT_PUBLIC_SUPABASE_ANON_KEY instead of NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY for consistency with current docs (both work, but anon key is more common in examples).
  </action>
  <verify>
    - `npm list @supabase/supabase-js @supabase/ssr` shows both packages installed
    - `.env.local` exists with NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY
    - `.env.local.example` updated with correct variable names
  </verify>
  <done>Packages installed, environment template ready for user to fill in real credentials</done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase client utility files</name>
  <files>lib/supabase/client.ts, lib/supabase/server.ts</files>
  <action>
    Create `lib/supabase/` directory (parallel to app/ directory).

    Create `lib/supabase/client.ts` for browser client:
    - Import `createBrowserClient` from '@supabase/ssr'
    - Export `createClient()` function that returns configured browser client
    - Use process.env.NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY
    - Use non-null assertion operator (!) since these are required

    Create `lib/supabase/server.ts` for server client:
    - Import `createServerClient` from '@supabase/ssr'
    - Import `cookies` from 'next/headers'
    - Export async `createClient()` function that returns configured server client
    - Configure cookies object with getAll() and setAll() methods per Next.js App Router pattern
    - Wrap setAll() in try-catch (Server Components can't write cookies, which is expected)

    Follow exact patterns from DISCOVERY.md code examples to avoid SSR issues.
  </action>
  <verify>
    - `lib/supabase/client.ts` exists and exports createClient function
    - `lib/supabase/server.ts` exists and exports async createClient function
    - `npm run build` succeeds (TypeScript compilation passes)
    - No TypeScript errors in lib/supabase/ files
  </verify>
  <done>Client utility files created following Next.js App Router + Supabase SSR best practices</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Configure Supabase project credentials in .env.local</action>
  <instructions>
    I've created the Supabase client utilities, but the environment variables contain placeholder values.

    To proceed with Phase 2:
    1. Create a Supabase project at https://supabase.com/dashboard (if you haven't already)
    2. Get your Project URL and API Key from the project settings
    3. Update `.env.local` with real values:
       - NEXT_PUBLIC_SUPABASE_URL=https://your-project-ref.supabase.co
       - NEXT_PUBLIC_SUPABASE_ANON_KEY=your-actual-anon-key

    These credentials are required for the next plan (database migration).
  </instructions>
  <verification>I can test the connection in Plan 2 once credentials are set</verification>
  <resume-signal>Type "done" when you've updated .env.local with real Supabase credentials</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] @supabase/supabase-js and @supabase/ssr packages installed
- [ ] lib/supabase/client.ts exists and follows browser client pattern
- [ ] lib/supabase/server.ts exists and follows server client pattern
- [ ] `npm run build` passes without TypeScript errors
- [ ] .env.local exists with placeholder values
- [ ] .env.local.example updated with correct variable names
- [ ] User instructed to add real Supabase credentials
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Supabase client utilities ready for use
- Environment configured (awaiting real credentials from user)
- No build errors or TypeScript issues
- Ready for Plan 2: Database schema migration
</success_criteria>

<output>
After completion, create `.planning/phases/02-supabase-backend/02-01-SUMMARY.md`:

# Phase 2 Plan 1: Supabase Client Setup - Summary

**Supabase client utilities created for Next.js App Router with dual client architecture.**

## Accomplishments

- Installed @supabase/supabase-js and @supabase/ssr packages
- Created lib/supabase/client.ts (browser client for Client Components)
- Created lib/supabase/server.ts (server client for Server Components/Actions)
- Configured environment variables template with correct naming
- Verified TypeScript compilation passes

## Files Created/Modified

- `package.json` - Added Supabase dependencies
- `lib/supabase/client.ts` - Browser client utility
- `lib/supabase/server.ts` - Server client utility
- `.env.local` - Created with placeholder credentials
- `.env.local.example` - Updated with NEXT_PUBLIC_SUPABASE_ANON_KEY naming

## Decisions Made

- Using `NEXT_PUBLIC_SUPABASE_ANON_KEY` naming (consistent with common examples, interchangeable with PUBLISHABLE_KEY)
- Dual client architecture required for App Router (browser vs server)

## Issues Encountered

None

## Next Step

Ready for 02-02-PLAN.md (Database Schema Migration) once user adds real Supabase credentials to .env.local.
</output>
